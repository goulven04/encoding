name: Charset and Encoding Info

on:
  workflow_dispatch:
  push:
  pull_request:

jobs:
  charset-info:
    runs-on: windows-2022

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: System and Locale Information
        run: |
          systeminfo | findstr /B /C:"OS Name" /C:"System Locale" /C:"Input Locale"

      - name: Code Page Information
        run: |
          reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\CodePage"

      - name: Environment Variables and Locale
        run: |
          set LANG
          set LC
          set

      - name: MSBuild Encoding Detection
        run: |
          msbuild -version

      - name: PowerShell Encoding Info
        run: |
          Write-Host 'Console Output Encoding:'; [Console]::OutputEncoding
          Write-Host 'System Default Encoding:'; [System.Text.Encoding]::Default
          Write-Host 'UTF-8 Encoding:'; [System.Text.Encoding]::UTF8"
          echo.

      - name: Git Encoding Config (if available)
        run: |
          git config --list | findstr encoding || echo No Git encoding configured.

      - name: Save All Results to File
        shell: cmd
        run: |
          systeminfo | findstr /B /C:"OS Name" /C:"System Locale" /C:"Input Locale"
          chcp
          reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\CodePage"
          set
          msbuild -version
          check_locale.exe
